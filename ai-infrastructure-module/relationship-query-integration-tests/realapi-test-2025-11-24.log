[[1;34mINFO[m] Scanning for projects...
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m-----< [0;36mcom.ai.infrastructure:relationship-query-integration-tests[0;1m >-----[m
[[1;34mINFO[m] [1mBuilding Relationship Query Real API Integration Tests 1.0.0[m
[[1;34mINFO[m] [1m--------------------------------[ jar ]---------------------------------[m
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mmaven-resources-plugin:2.6:resources[m [1m(default-resources)[m @ [36mrelationship-query-integration-tests[0;1m ---[m
[[1;34mINFO[m] Using 'UTF-8' encoding to copy filtered resources.
[[1;34mINFO[m] skip non existing resourceDirectory /workspace/ai-infrastructure-module/relationship-query-integration-tests/src/main/resources
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mmaven-compiler-plugin:3.13.0:compile[m [1m(default-compile)[m @ [36mrelationship-query-integration-tests[0;1m ---[m
[[1;34mINFO[m] Nothing to compile - all classes are up to date.
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mmaven-resources-plugin:2.6:testResources[m [1m(default-testResources)[m @ [36mrelationship-query-integration-tests[0;1m ---[m
[[1;34mINFO[m] Using 'UTF-8' encoding to copy filtered resources.
[[1;34mINFO[m] Copying 2 resources
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mmaven-compiler-plugin:3.13.0:testCompile[m [1m(default-testCompile)[m @ [36mrelationship-query-integration-tests[0;1m ---[m
[[1;34mINFO[m] Recompiling the module because of [1mchanged source code[m.
[[1;34mINFO[m] Compiling 4 source files with javac [forked debug target 21] to target/test-classes
[[1;33mWARNING[m] Unable to autodetect 'javac' path, using 'javac' from the environment.
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mmaven-surefire-plugin:3.0.0:test[m [1m(default-test)[m @ [36mrelationship-query-integration-tests[0;1m ---[m
[[1;34mINFO[m] Using auto detected provider org.apache.maven.surefire.junitplatform.JUnitPlatformProvider
[[1;34mINFO[m] 
[[1;34mINFO[m] -------------------------------------------------------
[[1;34mINFO[m]  T E S T S
[[1;34mINFO[m] -------------------------------------------------------
[[1;34mINFO[m] Running com.ai.infrastructure.relationship.it.realapi.[1mFinancialFraudRealApiIntegrationTest[m

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.0)

2025-11-24T11:28:58.700Z  INFO 61662 --- [           main] i.r.FinancialFraudRealApiIntegrationTest : Starting FinancialFraudRealApiIntegrationTest using Java 21.0.8 with PID 61662 (started by ubuntu in /workspace/ai-infrastructure-module/relationship-query-integration-tests)
2025-11-24T11:28:58.702Z  INFO 61662 --- [           main] i.r.FinancialFraudRealApiIntegrationTest : The following 1 profile is active: "realapi"
2025-11-24T11:28:59.230Z  INFO 61662 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-11-24T11:28:59.257Z  INFO 61662 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 23 ms. Found 10 JPA repository interfaces.
2025-11-24T11:28:59.536Z  INFO 61662 --- [           main] o.s.cloud.context.scope.GenericScope     : BeanFactory id=c8f8f7af-0bee-363f-bc14-0a0b8346c1b9
2025-11-24T11:28:59.941Z  INFO 61662 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 0 (http)
2025-11-24T11:28:59.946Z  INFO 61662 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-11-24T11:28:59.946Z  INFO 61662 --- [           main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-11-24T11:28:59.971Z  INFO 61662 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-11-24T11:28:59.972Z  INFO 61662 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1263 ms
2025-11-24T11:29:00.164Z  INFO 61662 --- [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2025-11-24T11:29:00.186Z  INFO 61662 --- [           main] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.3.1.Final
2025-11-24T11:29:00.201Z  INFO 61662 --- [           main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2025-11-24T11:29:00.302Z  INFO 61662 --- [           main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2025-11-24T11:29:00.314Z  INFO 61662 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-11-24T11:29:00.406Z  INFO 61662 --- [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:relationship_query_realapi user=SA
2025-11-24T11:29:00.407Z  INFO 61662 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-11-24T11:29:00.958Z  INFO 61662 --- [           main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-11-24T11:29:00.993Z  INFO 61662 --- [           main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-11-24T11:29:01.028Z  INFO 61662 --- [           main] c.a.i.p.onnx.ONNXAutoConfiguration       : Creating ONNX Embedding Provider (primary/default)
2025-11-24T11:29:01.029Z  WARN 61662 --- [           main] c.a.i.p.onnx.ONNXAutoConfiguration       : WARNING: ONNX Embedding Provider is not available. Model file may be missing.
2025-11-24T11:29:01.029Z  WARN 61662 --- [           main] c.a.i.p.onnx.ONNXAutoConfiguration       : Please ensure the ONNX model file exists at: classpath:/models/embeddings/all-MiniLM-L6-v2.onnx
2025-11-24T11:29:01.032Z  INFO 61662 --- [           main] c.a.i.p.onnx.ONNXEmbeddingProvider       : ========================================
2025-11-24T11:29:01.032Z  INFO 61662 --- [           main] c.a.i.p.onnx.ONNXEmbeddingProvider       : Initializing ONNX Embedding Provider
2025-11-24T11:29:01.032Z  INFO 61662 --- [           main] c.a.i.p.onnx.ONNXEmbeddingProvider       : Model path: classpath:/models/embeddings/all-MiniLM-L6-v2.onnx
2025-11-24T11:29:01.032Z  INFO 61662 --- [           main] c.a.i.p.onnx.ONNXEmbeddingProvider       : Tokenizer path: classpath:/models/embeddings/tokenizer.json
2025-11-24T11:29:01.032Z  INFO 61662 --- [           main] c.a.i.p.onnx.ONNXEmbeddingProvider       : Current working directory: /workspace/ai-infrastructure-module/relationship-query-integration-tests
2025-11-24T11:29:01.032Z  INFO 61662 --- [           main] c.a.i.p.onnx.ONNXEmbeddingProvider       : ========================================
2025-11-24T11:29:01.501Z  INFO 61662 --- [           main] c.a.i.p.onnx.ONNXEmbeddingProvider       : Model file resolved to: /tmp/onnx-model-3087264974340293977.onnx
2025-11-24T11:29:01.596Z  INFO 61662 --- [           main] c.a.i.p.onnx.ONNXEmbeddingProvider       : Using CPU for ONNX inference
2025-11-24T11:29:01.757Z  INFO 61662 --- [           main] c.a.i.p.onnx.ONNXEmbeddingProvider       : Model input names: [input_ids, attention_mask, token_type_ids]
2025-11-24T11:29:01.757Z  INFO 61662 --- [           main] c.a.i.p.onnx.ONNXEmbeddingProvider       :   Input: input_ids - TensorInfo(javaType=INT64,onnxType=ONNX_TENSOR_ELEMENT_DATA_TYPE_INT64,shape=[-1, -1])
2025-11-24T11:29:01.757Z  INFO 61662 --- [           main] c.a.i.p.onnx.ONNXEmbeddingProvider       :   Input: attention_mask - TensorInfo(javaType=INT64,onnxType=ONNX_TENSOR_ELEMENT_DATA_TYPE_INT64,shape=[-1, -1])
2025-11-24T11:29:01.757Z  INFO 61662 --- [           main] c.a.i.p.onnx.ONNXEmbeddingProvider       :   Input: token_type_ids - TensorInfo(javaType=INT64,onnxType=ONNX_TENSOR_ELEMENT_DATA_TYPE_INT64,shape=[-1, -1])
2025-11-24T11:29:01.757Z  INFO 61662 --- [           main] c.a.i.p.onnx.ONNXEmbeddingProvider       : Detected embedding dimension: 384
2025-11-24T11:29:01.760Z  WARN 61662 --- [           main] c.a.i.p.onnx.ONNXEmbeddingProvider       : Hugging Face tokenizers library not found on classpath. Falling back to legacy tokenization.
2025-11-24T11:29:01.760Z  INFO 61662 --- [           main] c.a.i.p.onnx.ONNXEmbeddingProvider       : ONNX Embedding Provider initialized successfully with model: /tmp/onnx-model-3087264974340293977.onnx
2025-11-24T11:29:01.764Z  INFO 61662 --- [           main] .a.i.c.AIInfrastructureAutoConfiguration : Creating AIEmbeddingService with embedding provider 'onnx' (requested 'onnx')
2025-11-24T11:29:01.784Z  INFO 61662 --- [           main] c.ai.infrastructure.cache.AICacheConfig  : AI Cache Manager configured with max size 100 and TTL PT1H
2025-11-24T11:29:01.799Z  INFO 61662 --- [           main] c.a.i.v.l.LuceneVectorDatabaseService    : Initializing Lucene Vector Database at: /tmp/relationship-query-realapi-lucene
2025-11-24T11:29:01.807Z  INFO 61662 --- [           main] o.a.l.s.MemorySegmentIndexInputProvider  : Using MemorySegmentIndexInput with Java 21 or later; to disable start with -Dorg.apache.lucene.store.MMapDirectory.enableMemorySegments=false
2025-11-24T11:29:01.868Z  INFO 61662 --- [           main] c.a.i.v.l.LuceneVectorDatabaseService    : Lucene Vector Database initialized successfully
2025-11-24T11:29:01.913Z  INFO 61662 --- [           main] c.a.i.provider.AIProviderManager         : Initializing AI Provider Manager with 1 providers
2025-11-24T11:29:01.913Z  INFO 61662 --- [           main] c.a.i.provider.AIProviderManager         : AI Provider Manager initialized successfully
2025-11-24T11:29:01.926Z  INFO 61662 --- [           main] c.a.i.c.AIEntityConfigurationLoader      : Loading AI entity configuration from: ai-entity-config.yml
2025-11-24T11:29:01.929Z  INFO 61662 --- [           main] c.a.i.c.AIEntityConfigurationLoader      : Found 3 entities in configuration
2025-11-24T11:29:01.929Z  INFO 61662 --- [           main] c.a.i.c.AIEntityConfigurationLoader      : Processing entity type: document with config keys: [features, searchable-fields]
2025-11-24T11:29:01.930Z  INFO 61662 --- [           main] c.a.i.c.AIEntityConfigurationLoader      : No metadata-fields found for entity document
2025-11-24T11:29:01.930Z  INFO 61662 --- [           main] c.a.i.c.AIEntityConfigurationLoader      : Processing entity type: product with config keys: [features, searchable-fields]
2025-11-24T11:29:01.930Z  INFO 61662 --- [           main] c.a.i.c.AIEntityConfigurationLoader      : No metadata-fields found for entity product
2025-11-24T11:29:01.930Z  INFO 61662 --- [           main] c.a.i.c.AIEntityConfigurationLoader      : Processing entity type: transaction with config keys: [features, searchable-fields]
2025-11-24T11:29:01.930Z  INFO 61662 --- [           main] c.a.i.c.AIEntityConfigurationLoader      : No metadata-fields found for entity transaction
2025-11-24T11:29:01.930Z  INFO 61662 --- [           main] c.a.i.c.AIEntityConfigurationLoader      : Successfully loaded configuration for 3 entities
2025-11-24T11:29:02.220Z  INFO 61662 --- [           main] o.s.d.j.r.query.QueryEnhancerFactory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2025-11-24T11:29:02.497Z  INFO 61662 --- [           main] c.a.i.config.AIConfigurationService      : Initializing AI Configuration Service
2025-11-24T11:29:02.498Z  INFO 61662 --- [           main] c.a.i.config.AIConfigurationService      : Hot-reload enabled with 300 second interval
2025-11-24T11:29:02.498Z  INFO 61662 --- [           main] c.a.i.config.AIConfigurationService      : AI Configuration Service initialized successfully
2025-11-24T11:29:02.512Z  INFO 61662 --- [           main] c.a.i.service.AICapabilityService        : AICapabilityService initialized with configurationLoader: present
2025-11-24T11:29:02.513Z  INFO 61662 --- [           main] c.a.i.service.AICapabilityService        : Configuration loader supports entity types: [product, document, transaction]
2025-11-24T11:29:02.607Z  INFO 61662 --- [           main] c.a.i.privacy.pii.PIIDetectionService    : PII detection initialized: enabled=false, mode=PASS_THROUGH, patterns=4
2025-11-24T11:29:02.730Z  INFO 61662 --- [           main] c.a.i.i.action.ActionHandlerRegistry     : ActionHandlerRegistry initialized with 2 action handler(s)
2025-11-24T11:29:02.849Z  INFO 61662 --- [           main] i.r.c.RelationshipQueryAutoConfiguration : Relationship query module enabled (maxTraversalDepth=3, defaultReturnMode=IDS, vectorSearchEnabled=true)
2025-11-24T11:29:02.982Z  WARN 61662 --- [           main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-11-24T11:29:03.362Z  INFO 61662 --- [           main] o.s.b.a.e.web.EndpointLinksResolver      : Exposing 1 endpoint(s) beneath base path '/actuator'
2025-11-24T11:29:03.527Z  INFO 61662 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 42207 (http) with context path ''
2025-11-24T11:29:03.538Z  INFO 61662 --- [           main] i.r.FinancialFraudRealApiIntegrationTest : Started FinancialFraudRealApiIntegrationTest in 5.04 seconds (process running for 5.544)
2025-11-24T11:29:04.180Z  INFO 61662 --- [o-auto-1-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-11-24T11:29:04.180Z  INFO 61662 --- [o-auto-1-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-11-24T11:29:04.181Z  INFO 61662 --- [o-auto-1-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 1 ms

=== OPENAI API REQUEST ===
URL: https://api.openai.com/v1/chat/completions
Model: gpt-4o-mini
Temperature: 0.1
Top-P: 0.1
Max Tokens: 1200
Messages count: 2

Message 0: role=system
  content: You are an expert database planner. Return ONLY a JSON object.

Message 1: role=user
  content: Analyze the user's request using the provided entity schema. Produce a JSON payload with:
- primaryEntityType (snake-case)
- candidateEntityTypes (array)
- relationshipPaths (array of {fromEntityType, relationshipType, toEntityType, direction, optional, conditions})
- directFilters (map of entity -> array of filters)
- relationshipFilters (map)
- needsSemanticSearch (boolean)
- queryStrategy ("RELATIONSHIP", "SEMANTIC", or "HYBRID")
- confidence (0.0 - 1.0 decimal)
- semanticQuery (string)

Schema:
No AI-capable entities are registered.

User Query: "List suspicious transactions over $25k from high-risk regions routed through the same counterparty"

Respond with valid JSON only.

=== END REQUEST ===

=== OPENAI API RESPONSE ===
Response Time: 9349ms
Model: gpt-4o-mini-2024-07-18
Finish Reason: stop
Response Content Length: 1162 chars
Content (first 500 chars):
{
  "primaryEntityType": "transaction",
  "candidateEntityTypes": [
    "region",
    "counterparty"
  ],
  "relationshipPaths": [
    {
      "fromEntityType": "transaction",
      "relationshipType": "originates_from",
      "toEntityType": "region",
      "direction": "outgoing",
      "optional": false,
      "conditions": {
        "amount": ">25000",
        "risk_level": "high"
      }
    },
    {
      "fromEntityType": "transaction",
      "relationshipType": "involves",
      "toEntit
=== END RESPONSE ===

2025-11-24T11:29:13.574Z  WARN 61662 --- [o-auto-1-exec-1] c.a.i.relationship.metrics.QueryMetrics  : Plan latency 9362ms exceeded alert threshold 1500
2025-11-24T11:29:13.574Z  WARN 61662 --- [o-auto-1-exec-1] c.a.i.r.s.RelationshipQueryPlanner       : Failed to obtain structured plan from LLM: Cannot deserialize value of type `java.util.ArrayList<com.ai.infrastructure.relationship.dto.FilterCondition>` from Object value (token `JsonToken.START_OBJECT`)
 at [Source: (String)"{
  "primaryEntityType": "transaction",
  "candidateEntityTypes": [
    "region",
    "counterparty"
  ],
  "relationshipPaths": [
    {
      "fromEntityType": "transaction",
      "relationshipType": "originates_from",
      "toEntityType": "region",
      "direction": "outgoing",
      "optional": false,
      "conditions": {
        "amount": ">25000",
        "risk_level": "high"
      }
    },
    {
      "fromEntityType": "transaction",
      "relationshipType": "involves",
      "toEntit"[truncated 662 chars]; line: 14, column: 21] (through reference chain: com.ai.infrastructure.relationship.dto.RelationshipQueryPlan["relationshipPaths"]->java.util.ArrayList[0]->com.ai.infrastructure.relationship.dto.RelationshipPath["conditions"])
2025-11-24T11:29:13.592Z  WARN 61662 --- [o-auto-1-exec-1] c.a.i.relationship.metrics.QueryMetrics  : Execution latency 9380ms exceeded alert threshold 1500
[[1;34mINFO[m] [1;32mTests run: [0;1;32m1[m, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 15.34 s - in com.ai.infrastructure.relationship.it.realapi.[1mFinancialFraudRealApiIntegrationTest[m
[[1;34mINFO[m] Running com.ai.infrastructure.relationship.it.realapi.[1mECommerceRealApiIntegrationTest[m

=== OPENAI API REQUEST ===
URL: https://api.openai.com/v1/chat/completions
Model: gpt-4o-mini
Temperature: 0.1
Top-P: 0.1
Max Tokens: 1200
Messages count: 2

Message 0: role=system
  content: You are an expert database planner. Return ONLY a JSON object.

Message 1: role=user
  content: Analyze the user's request using the provided entity schema. Produce a JSON payload with:
- primaryEntityType (snake-case)
- candidateEntityTypes (array)
- relationshipPaths (array of {fromEntityType, relationshipType, toEntityType, direction, optional, conditions})
- directFilters (map of entity -> array of filters)
- relationshipFilters (map)
- needsSemanticSearch (boolean)
- queryStrategy ("RELATIONSHIP", "SEMANTIC", or "HYBRID")
- confidence (0.0 - 1.0 decimal)
- semanticQuery (string)

Schema:
No AI-capable entities are registered.

User Query: "Show me blue shoes under $100 from Nike"

Respond with valid JSON only.

=== END REQUEST ===

=== OPENAI API RESPONSE ===
Response Time: 7498ms
Model: gpt-4o-mini-2024-07-18
Finish Reason: stop
Response Content Length: 972 chars
Content (first 500 chars):
{
  "primaryEntityType": "shoe",
  "candidateEntityTypes": ["brand", "color", "price"],
  "relationshipPaths": [
    {
      "fromEntityType": "shoe",
      "relationshipType": "belongs_to",
      "toEntityType": "brand",
      "direction": "forward",
      "optional": false,
      "conditions": []
    },
    {
      "fromEntityType": "shoe",
      "relationshipType": "has_color",
      "toEntityType": "color",
      "direction": "forward",
      "optional": false,
      "conditions": []
    },

=== END RESPONSE ===

2025-11-24T11:29:21.206Z  WARN 61662 --- [o-auto-1-exec-2] c.a.i.relationship.metrics.QueryMetrics  : Plan latency 7499ms exceeded alert threshold 1500
2025-11-24T11:29:21.206Z  WARN 61662 --- [o-auto-1-exec-2] c.a.i.r.s.RelationshipQueryPlanner       : Failed to obtain structured plan from LLM: Cannot construct instance of `com.ai.infrastructure.relationship.dto.FilterCondition` (although at least one Creator exists): no String-argument constructor/factory method to deserialize from String value ('color = 'blue'')
 at [Source: (String)"{
  "primaryEntityType": "shoe",
  "candidateEntityTypes": ["brand", "color", "price"],
  "relationshipPaths": [
    {
      "fromEntityType": "shoe",
      "relationshipType": "belongs_to",
      "toEntityType": "brand",
      "direction": "forward",
      "optional": false,
      "conditions": []
    },
    {
      "fromEntityType": "shoe",
      "relationshipType": "has_color",
      "toEntityType": "color",
      "direction": "forward",
      "optional": false,
      "conditions": []
    },
"[truncated 472 chars]; line: 32, column: 7] (through reference chain: com.ai.infrastructure.relationship.dto.RelationshipQueryPlan["directFilters"]->java.util.LinkedHashMap["shoe"]->java.util.ArrayList[0])
2025-11-24T11:29:21.214Z  WARN 61662 --- [o-auto-1-exec-2] c.a.i.relationship.metrics.QueryMetrics  : Execution latency 7507ms exceeded alert threshold 1500
[[1;34mINFO[m] [1;32mTests run: [0;1;32m1[m, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 7.564 s - in com.ai.infrastructure.relationship.it.realapi.[1mECommerceRealApiIntegrationTest[m
[[1;34mINFO[m] Running com.ai.infrastructure.relationship.it.realapi.[1mLawFirmRealApiIntegrationTest[m

=== OPENAI API REQUEST ===
URL: https://api.openai.com/v1/chat/completions
Model: gpt-4o-mini
Temperature: 0.1
Top-P: 0.1
Max Tokens: 1200
Messages count: 2

Message 0: role=system
  content: You are an expert database planner. Return ONLY a JSON object.

Message 1: role=user
  content: Analyze the user's request using the provided entity schema. Produce a JSON payload with:
- primaryEntityType (snake-case)
- candidateEntityTypes (array)
- relationshipPaths (array of {fromEntityType, relationshipType, toEntityType, direction, optional, conditions})
- directFilters (map of entity -> array of filters)
- relationshipFilters (map)
- needsSemanticSearch (boolean)
- queryStrategy ("RELATIONSHIP", "SEMANTIC", or "HYBRID")
- confidence (0.0 - 1.0 decimal)
- semanticQuery (string)

Schema:
No AI-capable entities are registered.

User Query: "Find all contracts related to John Smith in Q4 2023"

Respond with valid JSON only.

=== END REQUEST ===

=== OPENAI API RESPONSE ===
Response Time: 5461ms
Model: gpt-4o-mini-2024-07-18
Finish Reason: stop
Response Content Length: 943 chars
Content (first 500 chars):
{
  "primaryEntityType": "contract",
  "candidateEntityTypes": ["person"],
  "relationshipPaths": [
    {
      "fromEntityType": "person",
      "relationshipType": "related_to",
      "toEntityType": "contract",
      "direction": "forward",
      "optional": false,
      "conditions": [
        {
          "field": "name",
          "operator": "equals",
          "value": "John Smith"
        },
        {
          "field": "date",
          "operator": "within",
          "value": "Q4 2023"
=== END RESPONSE ===

2025-11-24T11:29:26.723Z  WARN 61662 --- [o-auto-1-exec-3] c.a.i.relationship.metrics.QueryMetrics  : Plan latency 5462ms exceeded alert threshold 1500
2025-11-24T11:29:26.723Z  WARN 61662 --- [o-auto-1-exec-3] c.a.i.r.s.RelationshipQueryPlanner       : Failed to obtain structured plan from LLM: Primary entity type 'contract' is not registered
2025-11-24T11:29:26.731Z  WARN 61662 --- [o-auto-1-exec-3] c.a.i.relationship.metrics.QueryMetrics  : Execution latency 5470ms exceeded alert threshold 1500
[[1;34mINFO[m] [1;32mTests run: [0;1;32m1[m, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 5.514 s - in com.ai.infrastructure.relationship.it.realapi.[1mLawFirmRealApiIntegrationTest[m
[[1;34mINFO[m] 
[[1;34mINFO[m] Results:
[[1;34mINFO[m] 
[[1;34mINFO[m] [1;32mTests run: 3, Failures: 0, Errors: 0, Skipped: 0[m
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m------------------------------------------------------------------------[m
[[1;34mINFO[m] [1;32mBUILD SUCCESS[m
[[1;34mINFO[m] [1m------------------------------------------------------------------------[m
[[1;34mINFO[m] Total time:  30.776 s
[[1;34mINFO[m] Finished at: 2025-11-24T11:29:26Z
[[1;34mINFO[m] [1m------------------------------------------------------------------------[m
