meta:
  phase: Phase 2 - Marketplace, Booking (no payment), Reviews, Cleaning, Agency/Manager, Notes
  goals: >
    Tenant reservations (no payments), marketplace discovery & public pages, reviews,
    cleaning jobs, estate-agent/manager workflows, project notes (polling).

tickets:
  - id: P2.1-A
    title: Tenant booking flow (hold→confirm w/out payment)
    backend:
      endpoints:
        - POST /api/bookings/hold
        - POST /api/bookings/confirm
      rules: {hold_ttl_minutes: 15, prevent_double_booking: true}
    frontend:
      routes: [/listing/[id]/book]
    acceptance:
      - Holds expire; confirmed bookings visible to owner

  - id: P2.1-B
    title: Reviews (listings & agencies; responses)
    backend:
      entities: [Review]
      endpoints: [POST /api/reviews, GET /api/reviews?subjectType&subjectId]
      rules: one_review_per_completed_stay
    frontend:
      routes: [embedded on listing/agency pages]
    acceptance:
      - Star averages; gating enforced

  - id: P2.2-A
    title: Cleaning packages & jobs
    backend:
      endpoints: [POST /api/cleaning/jobs, GET /api/cleaning/jobs?agencyId]
      integration: internal calendar only
    frontend:
      routes: [/cleaning/dashboard]
    acceptance:
      - Auto-create turnover job at check-out when opted-in

  - id: P2.2-B
    title: Estate agent / property manager workflows
    backend:
      endpoints:
        - POST /api/properties/{id}/apply-manager
        - POST /api/properties/{id}/approve-manager
    frontend:
      routes: [/manager/dashboard]
    acceptance:
      - Scoped permissions for MANAGER enforced

  - id: P2.3-A
    title: Marketplace & public profiles + SEO
    backend:
      endpoints:
        - GET /api/marketplace/providers?category&city&rating
        - GET /api/public/providers/{id}
        - GET /api/public/listings/{id}
    frontend:
      routes: [/providers, /providers/[id], /listings/[id]]
    acceptance:
      - SSR public pages; filters

  - id: P2.3-B
    title: Project notes (lightweight; polling)
    backend:
      entities: [ProjectNote]
      endpoints: [CRUD /api/projects/{id}/notes]
    frontend:
      routes: [/projects/[id]/notes]
      notes: poll every 10–15s; no realtime yet
    acceptance:
      - Notes CRUD; optimistic UI
